# 数据类型转换与检测

# 1 数据类型转换 (Type Conversion)

类型转换分为两种：PHP自动执行的**隐式转换**和由开发者强制执行的**显式转换**。
## 1.1 隐式类型转换 (Automatic / Type Juggling)
隐式转换，也称为“类型戏法”，是PHP根据代码上下文自动进行的类型转换。
- **数值上下文：** 当一个字符串与一个数字进行算术运算（如 `+`, `-`, `*`）时，PHP会尝试将该字符串转换为一个数字。
```php
$a = "10"; // 字符串
$b = 5;    // 整型
$result = $a + $b; // $a 被自动转换为整型 10
// $result 的值为 15 (整型)
```
- **字符串上下文：** 当一个数字与一个字符串使用连接符（`.`）时，该数字会被自动转换为字符串。
```php
$cost = 15; // 整型
$text = "价格是: " . $cost;
// $cost 被自动转换为 "15"
// $text 的值为 "价格是: 15" (字符串)
```
**布尔上下文：** 在 `if` 等条件语句中，PHP会自动将值转换为布尔型 (`true` 或 `false`)。
- **转换为 `false` 的值：**
    - `0` (整型)
    - `0.0` (浮点型)
    - `""` (空字符串)
    - `"0"` (字符串 "0")
    - 一个空数组
    - `NULL`
# 2 显式类型转换 (Explicit / Type Casting)
显式转换是开发者通过代码强制将一个变量转换为特定类型。这有两种主要方法：
**1. 使用类型强制转换符**
这是最常用的方法，在变量前加上用括号括起来的目标类型关键字。
- `(int)` 或 `(integer)`：转换为整型。
- `(float)` 或 `(double)`：转换为浮点型。
- `(string)`：转换为字符串。
- `(bool)` 或 `(boolean)`：转换为布尔型。
- `(array)`：转换为数组。
- `(object)`：转换为对象。
**示例：**
```php
$text_num = "123.45"; // 字符串
$my_int = (int)$text_num;   // 转换为整型, $my_int 值为 123
$my_float = (float)$text_num; // 转换为浮点型, $my_float 值为 123.45

$value = 100; // 整型
$my_str = (string)$value; // 转换为字符串, $my_str 值为 "100"
```
**2. 使用特定转换函数**
PHP也提供了一些函数来进行类型转换，功能与转换符类似。
- `intval($var)`：获取变量的整数值。
- `floatval($var)`：获取变量的浮点值。
- `strval($var)`：获取变量的字符串值。
# 3 数据类型检测
为了在执行操作前确认变量的类型，可以使用一系列PHP内置函数。
## 3.1 `gettype()` - 获取通用类型
`gettype()` 函数返回一个表示变量类型的字符串。
**示例：**
```php
$a = 10;
$b = "Hello";
$c = true;
$d = array(1, 2);

echo gettype($a); // 输出: "integer"
echo gettype($b); // 输出: "string"
echo gettype($c); // 输出: "boolean"
echo gettype($d); // 输出: "array"
```
**注意：** 在PHP 7.2 环境中，`gettype()` 对一个已关闭的资源会返回 `"resource (closed)"`，这比旧版本返回 `"unknown type"` 提供了更多信息。
## 3.2 `is_*` 函数 - 检查特定类型
使用 `is_*` 系列函数是进行类型检查的**首选方法**，因为它们的目标明确，并且总是返回一个布尔值（`true` 或 `false`）。
- `is_int($var)`：检查是否为整型。
- `is_float($var)`：检查是否为浮点型。
- `is_string($var)`：检查是否为字符串。
- `is_bool($var)`：检查是否为布尔型。
- `is_array($var)`：检查是否为数组。
- `is_object($var)`：检查是否为对象。
- `is_null($var)`：检查是否为 `NULL`。
- `is_resource($var)`：检查是否为资源。
- `is_numeric($var)`：检查是否为**数字**或**数字字符串** (在处理表单输入的数字时非常有用)。
**示例：**
```php
$input = "20"; // 这是一个字符串

if (is_int($input)) {
    // 这段代码不会执行
}

if (is_numeric($input)) {
    // 这段代码会执行，因为 "20" 是一个数字字符串
    $num = (int)$input; // 现在可以安全地转换它
}
```