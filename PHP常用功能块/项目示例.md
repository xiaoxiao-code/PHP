# 项目示例

# 1 综合项目一：每日日志系统

项目目的：创建一个简单的Web日志应用。用户可以为特定日期写入日志条目，系统将每个条目的内容（附加定时器）追加到一个以该日期命名的文本文件中。
综合知识点运用：
- 目录操作： (用于检查日志目录是否存在) `is_dir()`，`mkdir()`(用于创建日志目录)。
- 日期时间： (设置时区) `date_default_timezone_set()`，`date()`(获取当前日期Ymd和时间H:i:s)。
- 文件写入： (用于写入文件) `file_put_contents()`，并使用`FILE_APPEND`标志（`fopen`模式`'a'` 的快捷方式）来实现追加。
- 文件读取： (检查日志文件是否存在) `file_exists()`，`file_get_contents()`(读取日志内容)。
- 表单处理： `$_POST`和`isset()`。
## 1.1 完整代码 ( `journal.php`)
```php
<?php
// --- 1. 配置与初始化 ---

// 设置时区为 "PRC" (中华人民共和国) 
date_default_timezone_set('PRC'); 

// 定义日志存储的目录
$log_directory = "journal_logs"; 

// 初始化变量
$message = ""; // 用于反馈
$current_date = date("Y-m-d"); // 获取 "Y-m-d" 格式的当前日期 
$log_content = "";

// --- 2. 目录操作：检查并创建日志目录 ---
if (!is_dir($log_directory)) { // 
    mkdir($log_directory); // 
}

// --- 3. 文件写入：处理表单提交 ---
if (isset($_POST['submit'])) {
    $entry_content = trim($_POST['entry']);
    
    if (!empty($entry_content)) {
        // 获取当前时间 H:i:s 
        $timestamp = date("H:i:s"); 
        
        // 格式化要写入的行
        $log_line = $timestamp . " | " . $entry_content . "\n";
        
        // 定义日志文件名
        $file_path = $log_directory . "/" . $current_date . ".txt";
        
        // 使用 file_put_contents 和 FILE_APPEND 标志追加内容
        // 
        if (file_put_contents($file_path, $log_line, FILE_APPEND | LOCK_EX)) {
            $message = "日志已于 $timestamp 保存。";
        } else {
            $message = "错误：无法写入日志文件。";
        }
    } else {
        $message = "错误：日志内容不能为空。";
    }
}

// --- 4. 文件读取：加载今天的日志 ---
$today_log_file = $log_directory . "/" . $current_date . ".txt";

if (file_exists($today_log_file)) { // 
    // 一次性读取整个文件内容 
    $log_content = file_get_contents($today_log_file);
} else {
    $log_content = "今日暂无日志条目。";
}

?>
<!DOCTYPE html>
<html>
<head>
    <title>每日日志系统</title>
    <style>
        body { font-family: sans-serif; }
        .container { max-width: 600px; margin: 20px auto; }
        textarea { width: 98%; height: 100px; }
        .log-display { background: #f4f4f4; border: 1px solid #ddd; padding: 10px; margin-top: 20px; white-space: pre-wrap; }
        .message { background: #e0ffe0; padding: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>每日日志 - <?php echo $current_date; ?></h2>

        <?php if (!empty($message)) { echo "<p class='message'>$message</p>"; } ?>

        <form method="post" action="journal.php">
            <textarea name="entry" placeholder="在此输入日志内容..."></textarea>
            <br><br>
            <input type="submit" name="submit" value="保存今日日志">
        </form>

        <div class="log-display">
            <h3>今日日志内容：</h3>
            <?php echo htmlspecialchars($log_content); ?>
        </div>
    </div>

</body>
</html>
```
# 2 综合项目二：日志文件日期过滤器
项目目的：读取一个包含计时器的日志文件，并允许用户通过日期范围来筛选并显示这些日志。
综合知识点运用：
- 文件读取： `file_exists()` ，`file()`(将文件按行读入队列)。
- 日期时间： (将日期字符串转换为时间) `strtotime()`，`date()`（用于统计）。
- 字符串操作： (用于切割日志行) `explode()`，`trim()`。
- 表单处理：（ `$_GET`用于接收日期范围）`isset()`，。
## 2.1 准备日志文件 ( `access_log.txt`)
```txt
2025-11-12 08:30:00 | INFO | 用户 'admin' 登录。
2025-11-12 09:15:00 | WARN | 密码尝试失败 (IP: 192.168.1.5)。
2025-11-13 10:00:00 | INFO | 用户 'guest' 访问了首页。
2025-11-13 14:22:00 | INFO | 用户 'admin' 更新了配置。
2025-11-14 10:05:00 | INFO | 用户 'guest' 访问了产品页。
2025-11-14 11:00:00 | ERROR| 数据库连接失败。
```
## 2.2 完整代码 ( `filter.php`)
```php
<?php
$log_file = "access_log.txt";
$results = array(); // 存放筛选结果

// --- 1. 日期时间：获取表单提交的日期范围 ---
$start_date_str = @$_GET['start_date']; // 使用 @ 抑制未设置时的提示
$end_date_str = @$_GET['end_date'];

// 将日期字符串转换为 UNIX 时间戳
$start_ts = strtotime($start_date_str); // 
$end_ts = strtotime($end_date_str);

// --- 2. 文件读取与筛选 ---
if (file_exists($log_file)) { // 
    
    // 将日志文件的每一行读入数组 $lines 
    $lines = file($log_file);
    
    foreach ($lines as $line) {
        // 3. 字符串操作：解析日志行
        // "2025-11-12 08:30:00 | INFO | ..."
        $parts = explode(" | ", $line, 2); // 切割成 2 部分 
        
        if (count($parts) == 2) {
            $log_date_str = trim($parts[0]);
            
            // 4. 日期时间：转换日志时间为时间戳
            $log_ts = strtotime($log_date_str);
            
            // 5. 筛选逻辑
            $keep = true; // 默认显示
            
            if ($start_ts && $log_ts < $start_ts) {
                // 如果设置了开始日期，且日志时间早于开始时间，则不显示
                $keep = false;
            }
            if ($end_ts && $log_ts > ($end_ts + 86400)) { // +86400 包含结束当天的23:59
                // 如果设置了结束日期，且日志时间晚于结束时间，则不显示
                $keep = false;
            }

            if ($keep) {
                $results[] = $line; // 将符合条件的行添加到结果数组
            }
        }
    }
} else {
    $results[] = "错误：日志文件 $log_file 未找到。";
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>日志文件日期过滤器</title>
    <style>
        body { font-family: sans-serif; }
        .container { max-width: 700px; margin: 20px auto; }
        .log-display { background: #333; color: #eee; border: 1px solid #000; padding: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h2>日志文件日期过滤器</h2>
        
        <form method="get" action="filter.php">
            <label>开始日期:</label>
            <input type="date" name="start_date" value="<?php echo htmlspecialchars($start_date_str); ?>">
            
            <label>结束日期:</label>
            <input type="date" name="end_date" value="<?php echo htmlspecialchars($end_date_str); ?>">
            
            <input type="submit" value="筛选">
            <a href="filter.php">重置</a>
        </form>

        <div class="log-display">
            <?php
            if (count($results) > 0) {
                foreach ($results as $line) {
                    echo htmlspecialchars($line);
                }
            } else {
                echo "在指定日期范围内没有日志条目。";
            }
            ?>
        </div>
    </div>
</body>
</html>
```

