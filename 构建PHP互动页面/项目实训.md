# 项目实训

# 1 综合项目一：用户登录与会话管理系统

项目目的：综合运用`$_POST`表单处理、`session_start()`变量`$_SESSION`和`session_destroy()`进行会话管理，并使用`header()`进行服务器端页面跳转。
项目包含三个文件：
1. `login.php`（登录页面）
2. `welcome.php`（受保护的欢迎页面）
3. `logout.php`(登出脚本)
## 1.1 文件一：`login.php`(主登录页面)
该文件既包含HTML表单，也包含PHP处理逻辑（同页提交模式）。
```php
<?php
// 1. 启动或恢复会话。必须在所有 HTML 输出之前调用。
session_start();

// 检查是否已提交表单
if (isset($_POST['submit'])) {
    
    // 2. 获取表单数据
    $username = $_POST['username'];
    $password = $_POST['password'];

    // 3. 验证表单数据 (此处为硬编码验证)
    if ($username == 'admin' && $password == '123456') {
        
        // 4. 验证成功：定义会话变量
        $_SESSION['user_login'] = $username;
        
        // 5. PHP页面跳转：重定向到欢迎页面
        header("Location: welcome.php");
        exit; // 确保 header() 后停止执行脚本

    } else {
        
        // 6. PHP 嵌入 JavaScript：验证失败时弹出提示
        $error_message = "用户名或密码错误！";
        echo "<script>alert('{$error_message}');</script>";
    }
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>用户登录</title>
</head>
<body>

    <h2>请登录</h2>
    
    <form method="post" action="">
        <div>
            <label>用户名:</label>
            <input type="text" name="username">
        </div>
        <div>
            <label>密&nbsp;&nbsp;&nbsp;码:</label>
            <input type="password" name="password">
        </div>
        <input type="submit" name="submit" value="登录">
    </form>

</body>
</html>
```
## 1.2 文件二：`welcome.php`(受保护的欢迎页面)
此页面通过检查`$_SESSION`信号来确认用户是否已登录。
```php
<?php
// 1. 启动会话以访问 $_SESSION 变量
session_start();

// 2. 会话验证：检查 'user_login' 会话变量是否存在
if (!isset($_SESSION['user_login'])) {
    // 如果不存在，说明未登录，强制跳转回登录页面
    header("Location: login.php");
    exit;
}

// 3. 访问会话变量
$username = $_SESSION['user_login'];
?>
<!DOCTYPE html>
<html>
<head>
    <title>欢迎页面</title>
</head>
<body>

    <h2>欢迎您, <?php echo htmlspecialchars($username); ?>！</h2>
    <p>这是一个受保护的页面。</p>

    <p><a href="logout.php">点击这里退出登录</a></p>

</body>
</html>
```
## 1.3 文件三：`logout.php`(登出脚本)
此文件负责会话和重定向。
```php
<?php
// 1. 启动会话
session_start();

// 2. 删除所有会话变量
session_unset();

// 3. 删除会话 (销毁 session_id)
session_destroy();

// 4. 跳转回登录页面
header("Location: login.php");
exit;
?>
```
# 2 综合项目二：商品列表与详情页（JS验证版）
项目目的：综合运用HTML超链接进行页面跳转、`$_GET`获取URL参数、JavaScript客户端验证（`alert()`, `onsubmit`）以及`$_POST`处理表单。
项目包含两个文件：
1. `product_list.php`(商品列表)
2. `product_details.php`(商品详情与评论)
## 2.1 文件一：`product_list.php`
此文件使用`<a>`标签，通过 URL 提交参数。
```php
<!DOCTYPE html>
<html>
<head>
    <title>商品列表</title>
</head>
<body>
    <h2>商品列表</h2>
    <ul>
        <li><a href="product_details.php?id=101&name=笔记本电脑">笔记本电脑</a></li>
        <li><a href="product_details.php?id=102&name=智能手机">智能手机</a></li>
        <li><a href="product_details.php?id=103&name=蓝牙耳机">蓝牙耳机</a></li>
    </ul>
</body>
</html>
```
## 2.2 文件二：`product_details.php`
该文件实现了三个功能：获取URL参数、使用JS验证表单、处理表单提交。
```php
<?php
// 1. 获取 URL 参数值 (使用 $_GET)
// @ 符号抑制未定义索引的提示
$product_id = @$_GET['id'];
$product_name = @$_GET['name'];

// 2. 处理表单数据 (使用 $_POST)
$comment_result = "";
if (isset($_POST['submit_comment'])) {
    $comment = $_POST['comment'];
    // (此处应有数据库保存操作，项目中简化为 echo)
    $comment_result = "<h4>评论已收到：</h4><p>" . htmlspecialchars($comment) . "</p>";
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>商品详情</title>
    
    <script>
    // 参照 "【例 5-8】"
    function validateForm() {
        // 获取表单控件的值
        var comment = document.form1.comment.value;
        
        if (comment == "") {
            // 使用 alert() 方法
            alert("评论内容不能为空！");
            return false; // 阻止表单提交
        }
        
        return true; // 允许表单提交
    }
    </script>
</head>
<body>

    <h1><?php echo htmlspecialchars($product_name); ?></h1>
    <p>商品 ID: <?php echo htmlspecialchars($product_id); ?></p>
    <p>这里是 <?php echo htmlspecialchars($product_name); ?> 的详细描述...</p>
    
    <hr>
    
    <?php echo $comment_result; ?>

    <h3>发表评论</h3>
    <form name="form1" method="post" action="" onsubmit="return validateForm();">
        <textarea name="comment" style="width: 300px; height: 80px;"></textarea>
        <br>
        <input type="submit" name="submit_comment" value="提交评论">
    </form>
    
    <p>
        <a href="product_list.php">返回列表 (HTML跳转)</a>
        |
        <a href="#" onclick="window.history.back(); return false;">返回上一页 (JS跳转)</a>
    </p>

</body>
</html>
```