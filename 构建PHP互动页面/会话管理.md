# 会话管理

# 1 为什么需要会话管理

根据 HTTP 协议的特点，客户端与服务器的每次对话（请求）都被视为一个单独的过程例如，用户在登录页面输入了用户名和密码，但当用户请求访问第二个页面时，服务器默认已经“忘记”了该用户的登录状态。
会话管理的思想就是在网站中通过一个“会话”来跟踪用户，记录下用户的信息，从而实现在不同页面间传递这些信息。
# 2 会话的工作原理
## 2.1 什么叫会话（Session）
- 定义：用户从打开某个网页开始，到关闭该网页或进入另一个新网页的整个过程，称为会话（Session）。
## 2.2 会话的产生
- 当浏览器（客户端）第一次连接一个Web服务器时，服务器会为该浏览器创建一个会话（会话）。
- 同时，服务器会自动分配一个唯一的`session_id`，表示该浏览器的身份。
- 在客户端，浏览器将此`session_id`值存入本地的 Cookie 中。
- 此后，该浏览器每次访问服务器时，都会带着这个`session_id`（Cookie），服务器`session_id`可以通过找到对应的会话数据。
## 2.3 会话的超时期限
- 默认期限：会话的超时期限默认为24分钟（即1440秒，可以在`php.ini`文件中查看`session.gc_maxlifetime`）。
- 超时后果：如果用户停留在某个网页的时间超过24分钟，浏览器对应的会话会自动消失。
- 修改期限：可以通过`session_set_cookie_params()`函数超时期限。例如，修改为1分钟（60秒）：
```php
session_set_cookie_params(60);
```
重要规则：前面不能有语句 `session_set_cookie_params()` `session_start()` 。
# 3 实现会话
在 PHP 中实现会话的主要步骤如下：
1. 启动会话。
2. 定义会话变量。
3. 访问会话变量。
4. 删除会话变量。
5. 离开会话。
核心规则：在执行第2、3、4、5步之前，都必须先执行第1步（启动会话）。
## 3.1 启动会话
```php
session_start();
```
功能：首先检查浏览器对应的`session_id`是否存在。如果不存在则创建一个；如果存在，则打开该会话空间。
## 3.2 定义会话变量
```php
$_SESSION["变量名"] = 值;
```
功能：在会话空间中定义会话变量。会话变量保存在`$_SESSION`这个预定义端口（批量）中，用于保存各个浏览器独享的信息。
## 3.3 访问会话变量
```php
echo $_SESSION["变量名"];
```
说明：若未存在指定的变量名，则访问将会返回`null` 。
## 3.4 删除回忆
删除指定指标的格式：
```php
unset($_SESSION["变量名"]);
```
格式(删除所有数据)：
```php
session_unset();
```
功能：会删除所有会话变量，但仍保留会话空间 `session_unset()`。
## 3.5 离开会话
```php
session_destroy();
```
功能：删除会话所占的空间，即删除`session_id` 。
# 4 Session 的应用
利用Session，可以很方便地实现密码验证、购物车功能等需要跨页面跟踪用户状态的功能。